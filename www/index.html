<!DOCTYPE html>
<html>
    <head>
        <title>Capture SGF</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no;" />
        <link rel="stylesheet" type="text/css" href="jquery/jquery.mobile-1.0.1.min.css" />
        
        <link rel="stylesheet" media="screen" href="style.css" type="text/css" />
        <!-- iPad/iPhone specific css below, add after your main css >
         <link rel="stylesheet" media="only screen and (max-device-width: 1024px)" href="ipad.css" type="text/css" />		
         <link rel="stylesheet" media="only screen and (max-device-width: 480px)" href="iphone.css" type="text/css" />		
         -->
        <script type="text/javascript" charset="utf-8" src="jquery/jquery-1.7.1.min.js"></script>
        <script type="text/javascript" charset="utf-8">
            $(document).bind("mobileinit", function(){
                             $.mobile.loadingMessage = "Detecting Grid";
                             });
            $(document).bind("mobileinit", function(){
                             $.mobile.loadingMessageTextVisible = true;
                             });
        </script>
        <script type="text/javascript" charset="utf-8" src="jquery/jquery.mobile-1.0.1.min.js"></script>
        <script type="text/javascript" charset="utf-8" src="cordova-1.6.0.js"></script>
        
        <!-- plugin JS -->
        <script type="text/javascript" charset="utf-8" src="gocam-plugin.js"></script>
        <script type="text/javascript" charset="utf-8" src="Canvas2ImagePlugin.js"></script>
        <script type="text/javascript" charset="utf-8" src="ActionSheet.js"></script>
        
        <!-- main JS -->
        <script type="text/javascript" charset="utf-8" src="Gotracer.js"></script>
        <script type="text/javascript" charset="utf-8" src="filesystem_stuff.js"></script>
        
        
        <script type="text/javascript" src="player/js/all.compressed.js"></script>
        
        <script type="text/javascript" charset="utf-8">
            
            
            // TODO: move some of these functions into sep. documents
            
            var pictureSource;   // picture source
            var destinationType; // sets the format of returned value

            var currentMoveID = 0;
            var currentGameID = 0;
            var currentBoardSize = 19;
            
            var coords;
//            var coordsCopy;
            
            // Image Capture 
            var idealWidth = 300;
            var idealHeight = 400; // 402?
            var imageSource = '';
                        
            // File display and manipulation variables
            var root = null; // File System root variable
            var currentDir = null; // Current DirectoryEntry listed
            var parentDir = null; // Parent of the current directory
            var activeItem = null; // The clicked item
            var activeItemType = null; // d-directory, f-file
            var clipboardItem = null; // file or directory for copy or move
            var clipboardAction = null; // c-copy, m-move
            
            // Disable Scrolling 
            function preventBehavior(e) { 
                e.preventDefault(); 
            };
            document.addEventListener("touchmove", preventBehavior, false);
            
            
            function onBodyLoad() {
                document.addEventListener("deviceready", onDeviceReady, false);
            }
            
            // PhoneGap is ready to be used!
            function onDeviceReady() {
                pictureSource = navigator.camera.PictureSourceType;
                destinationType = navigator.camera.DestinationType;
                getFileSystem();
                clickItemAction();
                var db = window.openDatabase("Database", "1.0", "Moku", 200000);
                db.transaction(populateDB, errorCB, function(){
                               console.log('database populated');
                               });
                if (currentGameID == '0') { $('#game-control-buttons').hide(); }
            }
            
            /*--------------------------------------------- */
            //         initial GRID DETECTION               //
            /*--------------------------------------------- */
            
            // Called when a photo is successfully retrieved
            // and coordinates are needed.
            function onPhotoURISuccess(imageURI) {
                currentMoveID = currentMoveID + 1;
                var canvas = document.getElementById("canvas");
                var ctx = canvas.getContext("2d");
                
                var secondCanvas = document.getElementById("secondcanvas");
                var secondCtx = secondCanvas.getContext("2d");
                
                var image = new Image();
                
                image.onload = function(){

                    // ------------------------------------------------------------------
                    // default size
                    
                    // set canvas height and width to match image.
                    ctx.canvas.width = idealWidth;
                    ctx.canvas.height = idealHeight;
                    
                    // show loading message
                    // doesn't show when taking a second picture? spinner no spinny?
                    $.mobile.showPageLoadingMsg();
                    
                    ctx.drawImage(image, 0,0);
                    
                    // ------------------------------------------------------------------
                    // Canvas2ImagePlugin saves to Photo Library (maybe sends to Documents or temp dir instead?)
                    // might not be necessary if capturePhoto can specify w x h 
                    try {
//                        saveImage();
                        console.log("Image would be saved, but hey, let's not fill up the library right now");
                    } catch (e) {
                        console.log("can't save image - Exception: "+e);
                    }
                    
                    // ------------------------------------------------------------------
                    // a good point at which to get the corner coordinates from GoCam
                    // First pass only, unless following image changes considerably.
                    
                    console.log("About to run GocamPlugin");
                    
                    // try timing GocamPlugin
                    var startTime = new Date();
                    console.log("GocamPlugin startTime: " + startTime);
                    
                    filename = imageURI.replace("file://localhost", '');
                    try {
                        GocamPlugin.nativeFunction([filename] ,
                          function(result) {
                           var endTime = new Date();
                                                   console.log("GocamPlugin endTime: " + endTime);
                                                   console.log("GocamPlugin took: " + (endTime - startTime) + "ms");
                                                   coords = result;
                            goTracer = new GoTracer(image, canvas);
                            goTracer.setCorners(result);
                            goTracer.startScan();
                            console.log(goTracer.getSGF());
                                                   
                            // all done, hide loading message
                            $.mobile.hidePageLoadingMsg();
                                                   
                            // Approve or Update current moves in SGF file?
                            // temporary - just write all SGF to file.
                            writeFile(goTracer.getSGF(), function(){
                                                             reloadEidogo();
                                                             });
                            // save move to databse
                            saveMovetoDB(goTracer.getSGF());
                            
                            // ------------------------------------------------------------------
                            // save SGF to disk? Send via Email? Open in Browser? Display using eidogo?
                            // save in iTunes

                          },
                                                   
                          function(error) {
                            console.log("GoCam - Error : \r\n"+error);      
                          }
                        ); 
                    } catch (e) {
                        console.log("Exception: "+e);
                    }
                    
                };
                image.src = imageURI;
                
                
            }
            
                       
            
            /* -------------------------- */
            //  Database Functions
            /* -------------------------- */
            
            // Populate the database 
            function populateDB(tx) {
                console.log('populateDB called');
                tx.executeSql('DROP TABLE IF EXISTS MOVES');
                tx.executeSql('DROP TABLE IF EXISTS GAMES');
                tx.executeSql('CREATE TABLE IF NOT EXISTS MOVES (id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, gameid, movedata)');
                tx.executeSql('CREATE TABLE IF NOT EXISTS GAMES (id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, PB, BR, PW, WR, SZ, KM, HA, DT, gamedata)');
                // PB, BR, PW, WR, SZ, KM, HA, DT, 
            }
            
            // Query the database
            function queryDB(tx) {
                console.log("queryDB called");
                tx.executeSql('SELECT * FROM MOVES', [], querySuccess, errorCB);
            }
            
            // Query the success callback
            function querySuccess(tx, results) {
                var len = results.rows.length;
                console.log("MOVES table: " + len + " rows found.");
                for (var i=0; i<len; i++){
                    console.log("Row = " + i + " ID = " + results.rows.item(i).id + " movedata = " + results.rows.item(i).movedata);
                }
            }
            
            // Error callback
            function errorCB(err) {
                console.log("ERROR processing SQL: "+err.code);
            }
            
            // Success callback
            function successCB() {
                console.log("successCB called");
                var db = window.openDatabase("Database", "1.0", "Moku", 200000);
                db.transaction(queryDB, errorCB);
            }

            
            // Save a move to the Database
            function saveMovetoDB(newMove) {
                var db = window.openDatabase("Database", "1.0", "Moku", 200000);
                db.transaction(
                               function(tx){
                               tx.executeSql('INSERT INTO MOVES (gameid, movedata) VALUES ('+ currentGameID +', "'+ newMove +'")');
                               }, errorCB, function() {
                               var db = window.openDatabase("Database", "1.0", "Moku", 200000);
                               db.transaction(function(tx){
                                              tx.executeSql('SELECT * FROM MOVES', [], function(tx, results) {
                                                            var len = results.rows.length;
                                                            console.log("MOVES table: " + len + " rows found.");
                                                            for (var i=0; i<len; i++){
                                                            console.log("Row = " + i + " ID = " + results.rows.item(i).id + " gameid = "+ results.rows.item(i).gameid +" movedata = " + results.rows.item(i).movedata);
                                                            }

                                                            }, errorCB);
                                              }, errorCB);
                               });
            }
            
            /* -------------------------- */
            //       GAME listing
            /* -------------------------- */
            
            function listGamesArchive() {
                // lists GAMES db on gamesArchive page
                var list = '';
                var db = window.openDatabase("Database", "1.0", "Moku", 200000);
                db.transaction(function(tx){
                               tx.executeSql('SELECT * FROM GAMES', [], function(tx, results) {
                                             var len = results.rows.length;
                                             console.log("GAMES table: " + len + " rows found.");
                                             for (var i=0; i<len; i++){
                                             var pb = '';
                                             var pw = '';
                                             var row = results.rows.item(i);
                                             if (row.SZ !== null) {
                                                 if (row.PB !== null ){ pb = '<br />Black: '+ row.PB; }
                                                 if (row.PW !== null ){ pw = '<br />White: '+ row.PW; }
                                                 list += "<li><a href=\"#\" onclick=\"viewGameDetails();\"><h3>" + row.DT +"</h3><p>"+ pb +pw  +"<br />Board size: "+ row.SZ +"</p></a></li>";
                                             }
                                             }
                                             $('ul#archive-list').html(list);
                                             $('ul#archive-list').listview('refresh');
                                             window.location = '#gamesArchive';
                                             }, errorCB);
                               }, errorCB);                
            }
            
            function listGamesDB() {
                // spit GAMES db to console.
                var db = window.openDatabase("Database", "1.0", "Moku", 200000);
                db.transaction(function(tx){
                               tx.executeSql('SELECT * FROM GAMES', [], function(tx, results) {
                                             var len = results.rows.length;
                                             console.log("GAMES table: " + len + " rows found.");
                                             for (var i=0; i<len; i++){
                                             var row = results.rows.item(i);
                                             console.log("Row " + i + ": id=" + row.id +" PB="+ row.PB +" BR="+ row.BR +" PW="+ row.PW +" WR="+ row.WR +" SZ="+ row.SZ +" KM="+ row.KM +" HA="+ row.HA +" DT="+ row.DT +" gamedata = " + row.gamedata);
                                             }
                                             
                                             }, errorCB);
                               }, errorCB);
            }
            
            function viewGameDetails() {
                // Display game particulars
                
                
                // edit details link
                // link to send/save/display
            }

            
            function getHighestGameID(callback) {
                var db = window.openDatabase("Database", "1.0", "Moku", 200000);
                db.transaction(function (tx) {
                               tx.executeSql("SELECT id FROM GAMES", [], function (tx, result) {
                                             var highestGameIDinDB = 0;
                                             for (var i = 0; i < result.rows.length; ++i) {
                                             var row = result.rows.item(i);
                                             if (row['id'] > highestGameIDinDB) {
                                             highestGameIDinDB = row['id'];
                                             }
                                             }
                                             console.log('getHighestGameID says: ' + highestGameIDinDB);
                                             callback(highestGameIDinDB);
                                             }, function (tx, error) {
                                             console.log('could not SELECT id FROM GAMES - ' + error.message);
                                             return;
                                             });
                               });            
            }


            
            /* -------------------------- */
            //       Save Forms
            /* -------------------------- */
            
            function saveGameFormSubmit() {
                // used when starting a new game
                savePrefsFormtoDB();
                selectAction();
            }
            
            function editGameFormSubmit() {
                // for editing an existing game
                savePrefsFormtoDB();
            }
            
            function editGameDetails(gameid){
                console.log('editGameDetails gameid='+gameid);
                // TODO: are SQL results an array?
                // TODO: seems like the val() stuff should put the array into the form... but no go.
                // setup edit Form using supplied GAME id
                // get game info from DB, load it into an array, populate editGameForm using array
                var db = window.openDatabase("Database", "1.0", "Moku", 200000);
                db.transaction(function(tx){
                               tx.executeSql('SELECT * FROM GAMES WHERE id='+gameid, [], function(tx, results) {
                                             // http://stackoverflow.com/questions/172524/populate-a-form-with-data-from-an-associative-array-with-jquery
                                             // the following isn't working because I don't understand jQuery.
                                             try {
                                             $.each(results.rows, function(name,value) { $("#editGameForm input[name='" + name + "']").val(value); console.log(name +" "+ value);});
                                             }catch(e){
                                             console.log('editGameDetails jquery error: ' +e);
                                             }
                                             }, errorCB);
                               }, errorCB);
            }
            
            
            function savePrefsFormtoDB() {
                // should probably be just :input so that it will work with saveGameForm and editGameForm
                var fields = $("#prefsForm :input").serializeArray();
                
                var d = new Date();
                var DTval = d.getFullYear() +"-"+ d.getMonth() +"-"+ d.getDate();
                
                var updateString = " ";
                jQuery.each(fields, function(i, field){
                            if (field.name == 'SZ') {
                            currentBoardSize = field.value;
                            }
                            if (field.value != '') {
                            updateString += field.name +'="'+ field.value +'",';
                            }
                            });
                updateString += 'DT="'+DTval+'"';
                
                var updateGameSQL = 'UPDATE GAMES SET '+ updateString +' WHERE id='+ currentGameID;

                var db = window.openDatabase("Database", "1.0", "Moku", 200000);
                db.transaction(
                               function(tx){
                               tx.executeSql(updateGameSQL);
                               }, errorCB, listGamesDB);

            
            }
            
            
            // Takes the contents of a form and turns it into a string, adds to DB
//            function SGFpreamble() {
//                console.log("SGFpreamble begins");
//                var d = new Date();
//                var DTval = d.getFullYear() +"-"+ d.getMonth() +"-"+ d.getDate();
//                var $inputs = $('#prefsForm :input');
//                var preambleText = "(\r\n;FF[4]\r\nGM[1]\r\nAP[Moku]\r\nDT["+DTval+"]\r\n";
//                
//                $inputs.each(function() {
//                             // add form values - watch out for radio buttons.
//                             if (this.name == 'SZ') {
//                             if ($(this).attr('checked')) {
//                             preambleText += this.name + "[" + $(this).val() + "]\r\n";
//                             currentBoardSize = $(this).val();
//                             }
//                             } 
//                             else {
//                             preambleText += this.name + "[" + $(this).val() + "]\r\n";
//                             }
//                             });
//                // console.log(preambleText);
//                // save Preamble to database
//                var db = window.openDatabase("Database", "1.0", "Moku", 200000);
//                db.transaction(
//                               function(tx){
//                               // this will actually require finding the currentGameID, then UPDATE that row 
//                               // also, if there is no record it will have to be created?
//                               tx.executeSql('UPDATE GAMES SET gamedata="'+preambleText+'" WHERE id='+currentGameID);
//                               }, errorCB, listGamesDB);
//                selectAction();
//            }

            /* -------------------------- */
            //    New Game Functions
            /* -------------------------- */
            function newGameRecord() {
                // create a new record in GAMES db
                // and sets currentGameID to that new gameid
                // then go to SaveGame page to set details
                console.log('newGameRecord called');
                var db = window.openDatabase("Database", "1.0", "Moku", 200000);
                db.transaction(function (tx) {
                               tx.executeSql('INSERT INTO GAMES (gamedata) VALUES ("")');
                               }, errorCB, function () {
                               // set currentGameID to new (highest) in Database
                               getHighestGameID(function (highestId) {
                                                 currentGameID = highestId;
                                                 console.log('currentGameID is now '+currentGameID);
                                                 });
                               });
                window.location = "#saveGame";
                
            }
            
                        
            function stopGameCapture() {
                console.log('stopGameCapture called');
                // Finish game Recording
                // set currentGameID to zero, ie Not Recording.
                currentGameID = 0;
            }
            
                        
            function confirmNewGame(button) {
                // 1: NO
                // 2: YES (start new Capture session)
                if (button == 2){
                    // create new game record, set currentGameID
                    newGameRecord();
                    // TODO Stop image capture (NOT IN PLACE YET)
                    
                    // enable Grid and Save buttons
                    $('#game-control-buttons').show();
                    
                    // go to SaveGame form, save details
                    window.location = "#saveGame";
                    
                    // SaveGame form should then launch selectAction
                    
                }
            }
            
            
            function newGame() {
                console.log('newGame?');
                // Check for currently running Capture Session
                // if there's already a game, check to see if user wants to stop and create a new one:
                if (currentGameID > 0) {
                    console.log('currentGameID "'+ currentGameID +'" is greater than 0 so a capture session is already running');
                    navigator.notification.vibrate(1000); // not working?
                    navigator.notification.confirm(
                                                   'Stop current game capture and start a new one?',  // message
                                                   confirmNewGame,                                  // callback to invoke with index of button pressed
                                                   'Capture session running',                       // title
                                                   'No,Yes'                                         // buttonLabels
                                                   );
                }
                else {
                    console.log('currentGameID is NOT greater than 0, so there is NO capture session running');
                    // Otherwise, no existing games, so create new game record, start capture
                    newGameRecord();
                    // TODO Add step to fill out SGFPreamble first, then launch selectAction
                    
                }
            }
            
            /* -------------------------- */
            //         Accept Grid        //
            /* -------------------------- */
            function acceptGrid() {
                // If the grid looks good
                // write initial grid to disk/add to database?
                if (currentGameID > '0') { $('#game-control-buttons').show(); } // TODO hide instructions
                // go to main page
                // reload Eidogo
                reloadEidogo();
                window.location = "#page1";
                
                // TODO start Automatic Image Capture
                // NOT IMPLEMENTED YET
            }
            
            /* -------------------------- */
            // Canvas2ImagePlugin Function
            /* -------------------------- */
            
            function saveImage()
            {
                var canvas2ImagePlugin = window.plugins.canvas2ImagePlugin;
                canvas2ImagePlugin.saveImageDataToLibrary(
                                                          function(msg){
                                                          console.log(msg);
                                                          }, 
                                                          function(err){
                                                          console.log(err);
                                                          }, 
                                                          'canvas'
                                                          );
            }
            
            /* ------------------- */
            /*  PhoneGap Functions */
            /* ------------------- */
            
            // A button will call this function
            
            function capturePhoto() {
                /*
                 
                 File saved to Photo Album is full-size, no cropping, regardless of targetWidth/Height
                
                 Orientation and cropping/size issues will be resolved in Cordova 1.7 according to mailing lists
                 
                 targetWidth:100, targetHeight:400
                     correctOrientation: 0
                            take the picture with phone sideways and the resulting cropped image has object pointing sideways
                                (CAN'T REPLICATE THIS)
                     correctOrientation: 1
                            take the picture with phone sideways and resulting cropped image has object pointing up
                 
                 
                 targetWidth:320, targetHeight:240 (also 480, 640)
                    correctOrientation: 0
                        picture taken upright, image is cropped object pointing up (top and bottom cropped)
                        picture taken sideways, image is object pointing  up (image resized to correct dimensions)
                    correctOrientation: 1
                        picture taken upright, image is cropped, object pointing up (top and bottom cropped)
                        picture taken sideways, image has object pointing up (image resized to correct dimensions)
                
                        
                 
                */
                // USED FOR "CAMERA" CAPTURE
                // Take picture using device camera and retrieve image as base64-encoded string
                // savetoPhotoAlbum is turned on to compare with Canvas2Image Plugin 
                navigator.camera.getPicture(onPhotoURISuccess, onFail, { 
                                            quality: 50, 
                                            targetWidth: idealWidth,
                                            targetHeight: idealHeight,
                                            correctOrientation: 0,
                                            saveToPhotoAlbum: 0
                                            });
            }
            
                        
            function getPhoto(source) {
                // PHOTO LIBRARY
                // Retrieve image file location from specified source
                navigator.camera.getPicture(onPhotoURISuccess, onFail, { 
                                            quality: 50, 
                                            destinationType: destinationType.FILE_URI,
                                            targetWidth: idealWidth,
                                            targetHeight: idealHeight,
                                            correctOrientation: 1,
                                            sourceType: source,
                                            saveToPhotoAlbum: 0
                                            });
            }
            
            function capturePhotoEdit() {
                // NOT CURRENTLY USED
                // Take picture using device camera, allow edit, and retrieve image as base64-encoded string  
                navigator.camera.getPicture(onPhotoURISuccess, onFail, { quality: 20, allowEdit: true }); 
            }
     
            
            // used instead of console.log in a few instances.
            function printObject(o) {
                var out = '';
                for (var p in o) {
                    out += p + ': ' + o[p] + '\n';
                }
                console.log(out);
            }
            
            
            /* -------------------------------- */
            //      Write SGF to file           //
            /* -------------------------------- */
            function writeFile(SGF, callback) {
                console.log("writeFile begins");
                window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, function(fileSystem){
                                         console.log("writeFile root filesystem: " + fileSystem.root.name);
                                         fileSystem.root.getFile("SGF.txt", {create: true, exclusive: false}, function(fileEntry){
                                                                 console.log("writeFile - fileEntry");
                                                                 fileEntry.createWriter(function(writer){
                                                                                        writer.onwriteend = function(evt) {
                                                                                        console.log("writeFile - SGF.txt written");
                                                                                        callback();
                                                                                        
                                                                                        }
                                                                                        writer.write(SGF);
                                                                                        }, onFail);
                                                                 }, onFail); 
                                         }, onFail); 
            }
            
                        
            function onFail(err) {
                console.log(err)
            }
            
                       
            /* -------------------------- */
            //    ActionSheet Function    //
            //   Select Camera/Photo Lib  //
            /* -------------------------- */
            function selectAction() {
                var actionSheet = window.plugins.actionSheet;
                window.location = "#camera";
                // check for currentGameID - if it's 0, create a new one?
                // Nope, can't do that. sometimes we'll be clicking this to update Grid...
                
                // Select Source
                actionSheet.create('Select Image Source', ['Camera', 'Photo Library', 'Cancel'], function(buttonValue, buttonIndex) {
                                   if (arguments[1] == '0'){
                                   capturePhoto();
                                   // set default image source?
                                   }
                                   if (arguments[1] == '1') {
                                   getPhoto(pictureSource.PHOTOLIBRARY);
                                   // set default image source?
                                   }
                                   else {
                                   window.location = "#page1"; // return to main page.
                                   }

                                   }, {cancelButtonIndex: 2});
        
            }
            
            /* -------------------------- */
            //     Eidogo SGF display     //
            /* -------------------------- */
            function reloadEidogo() {
                // set sgfUrl to "SGF.txt" for local browser testing
                // set sgfUrl to "../../Documents/SGF.txt" (saved by writeFile) for other tests
                var player = new eidogo.Player({
                                               container:       "player-container", // HTML element id indicating where to put the player
                                               theme:           "compact",          // "standard" or "compact"
                                               sgfUrl:          "../../Documents/SGF.txt", // relative URL (within same domain) to SGF file to load 
                                               loadPath:        [0, 1000],  // Location within the game tree to start. 1000 should start at last move.
                                               mode:            "play",     // "play" or "view"
                                               showComments:    false,
                                               showPlayerInfo:  false,
                                               showGameInfo:    false,
                                               showTools:       false,
                                               showOptions:     false,
                                               markCurrent:     true,
                                               markVariations:  false,
                                               markNext:        true,
                                               enableShortcuts: false,
                                               problemMode:     false
                                               });
                console.log("Eidogo reloaded");
                
                // TODO: send a move to eidogo - not here, this is just for testing.
                try {
//                    player.setColor('B');
//                    player.createMove('dj');
                    player.playMove('B','dj');
                }catch(e){
                    console.log(e);
                }
                // how to add some HTML to this without modifying the source js?
//                $('.controls-container').append("<form id='sliderform'><label id='sliderlabel' for='slider'>Move:</label><input type='range' name='slider' id='slider' value='50' min='0' max='400' data-highlight='true' /></form>");

            }
            
            </script>
    </head>
    
    <body onload="onBodyLoad()">
        
        
        <div data-role="page" id="page1">
            <div data-theme="a" data-role="header">
                <h3>
                    Moku
                </h3>
                <!--
                <a data-role="button" data-rel="dialog" data-transition="pop" href="#prefs" data-icon="gear" data-iconpos="notext" data-shadow="false">
                    Prefs
                </a>
                 -->
                <a data-role="button" data-transition="fade" data-icon="plus" data-shadow="false" onclick="newGame();">
                    New
                </a>
                <!--
                 <a data-role="button" data-transition="slideup" href="#page4" onclick="listDir(root);">
                    File Archives
                </a>
                 -->
                <a data-role="button" data-transition="slide" href="#gamesArchive" onclick="listGamesArchive();">
                    Archives
                </a>
            </div>
            <div data-role="content">
                <div id="sgfdisplay">
                    <div id="player-container"></div>
                    <div id="game-control-buttons">
                    <a id="gridButton" data-role="button" data-inline="true" data-icon="grid" data-mini="true" data-transition="flip" onclick="selectAction();">
                        Grid
                    </a>
                    <a id="saveButton" data-role="button" data-inline="true" data-mini="true" data-transition="fade" href="#editGame" data-icon="check" data-iconpos="left" onclick="editGameDetails(currentGameID);">
                        Edit
                    </a>
                   
                    <a data-role="button" data-inline="true" data-iconpos="notext" data-transition="fade" href="#page1" data-icon="refresh" data-iconpos="left" onclick="reloadEidogo();">
                        Refresh 
                    </a>
                    
                    </div>
                    <!-- eidogo-player-auto can contain SGF which *should* be displayed 
                    <div class="eidogo-player-auto"></div>-->
                    <div id="sgfoutput"></div>
                    
                </div>
            </div>
        </div>
        
        
        
        <div data-role="page" id="camera">
            <div data-theme="a" data-role="header">
                <h3>
                    Camera
                </h3>
                <a data-role="button" data-direction="reverse" data-transition="flip" href="#page1" data-icon="back" data-iconpos="left">
                    Cancel
                </a>
                <a data-role="button" data-direction="reverse" data-transition="flip" href="#page1" data-icon="" onclick="acceptGrid();">
                    Accept
                </a>
            </div>
            <div data-role="content">
                <div id="camerasetup">
                    <canvas id="canvas"></canvas>
                    <canvas id="secondcanvas"></canvas>
                </div>
            </div>
        </div>
        
        
        <div data-role="page" id="saveGame">
            <div data-theme="a" data-role="header">
                <h3>
                    Save Game
                </h3>
                <a data-role="button" data-direction="reverse" data-transition="fade" href="#page1" data-icon="arrow-l" data-iconpos="left">
                    Cancel
                </a>
            </div>
            <div data-role="content">
                <form id="prefsForm" action="#" method="POST"> <!-- action was "#page1" -->
                    <!-- Need to add Rules (RU = Japanese, Chinese, etc) -->
                    <!-- Location/Place (PC), time (TM)(ie length of game) should be added automatically? -->
                    <label for="textinput1">
                        Black:
                    </label>
                    <input id="textinput1" name="PB" placeholder="Player Name" value="" type="text" /><input id="textinputbr" name="BR" placeholder="Rank" value="" type="text" />
                    <label for="textinput2">
                        White:
                    </label>
                    <input id="textinput2" name="PW" placeholder="Player Name" value="" type="text" /><input id="textinputwr" name="WR" placeholder="Rank" value="" type="text" />
                    <fieldset data-role="controlgroup" data-type="horizontal">
                        <legend>
                            Board Size:
                        </legend>
                        <input name="SZ" id="radio1" value="19" type="radio" checked="checked" />
                        <label for="radio1">
                            19x19
                        </label>
                        <input name="SZ" id="radio2" value="13" type="radio" disabled="true" />
                        <label for="radio2">
                            13x13
                        </label>
                        <input name="SZ" id="radio3" value="9" type="radio" disabled="true" />
                        <label for="radio3">
                            9x9
                        </label>
                    </fieldset>
                    <div class="formdetails">
                        <label for="textinput3">
                            Komi:
                        </label>
                        <input id="textinput3" name="KM" placeholder="Komi" value="5.5" type="number" />
                    </div>
                    <div class="formdetails">
                        <label for="textinput4">
                            Handicap:
                        </label>
                        <input id="textinput4" name="HA" placeholder="Handicap" value="0" type="number" />
                    </div>
                    <a href="#" data-role="button" data-direction="reverse" data-theme="b" data-icon="arrow-r" data-iconpos="right" onclick="saveGameFormSubmit();">Save Settings</a>
                    <!-- <input type="submit" data-direction="reverse" data-icon="arrow-r" data-iconpos="right" value="Submit Settings" onsubmit="saveGameFormSubmit();" /> -->
                </form>
            </div>
        </div>
        
        
        <div data-role="page" id="editGame">
            <div data-theme="a" data-role="header">
                <h3>
                    Edit Game
                </h3>
                <a data-role="button" data-direction="reverse" data-transition="fade" href="#page1" data-icon="arrow-l" data-iconpos="left">
                    Cancel
                </a>
            </div>
            <div data-role="content">
                <form id="editGameForm" action="#" method="POST"> <!-- action was "#page1" -->
                    <!-- Need to add Rules (RU = Japanese, Chinese, etc) -->
                    <!-- Location/Place (PC), time (TM)(ie length of game) should be added automatically? -->
                    <label for="textinput1">
                        Black:
                    </label>
                    <input id="textinput1" name="PB" placeholder="Player Name" value="" type="text" /><input id="textinputbr" name="BR" placeholder="Rank" value="" type="text" />
                    <label for="textinput2">
                        White:
                    </label>
                    <input id="textinput2" name="PW" placeholder="Player Name" value="" type="text" /><input id="textinputwr" name="WR" placeholder="Rank" value="" type="text" />
                    <fieldset data-role="controlgroup" data-type="horizontal">
                        <legend>
                            Board Size:
                        </legend>
                        <input name="SZ" id="radio1" value="19" type="radio" checked="checked" />
                        <label for="radio1">
                            19x19
                        </label>
                        <input name="SZ" id="radio2" value="13" type="radio" disabled="true" />
                        <label for="radio2">
                            13x13
                        </label>
                        <input name="SZ" id="radio3" value="9" type="radio" disabled="true" />
                        <label for="radio3">
                            9x9
                        </label>
                    </fieldset>
                    <div class="formdetails">
                        <label for="textinput3">
                            Komi:
                        </label>
                        <input id="textinput3" name="KM" placeholder="Komi" value="5.5" type="number" />
                    </div>
                    <div class="formdetails">
                        <label for="textinput4">
                            Handicap:
                        </label>
                        <input id="textinput4" name="HA" placeholder="Handicap" value="0" type="number" />
                    </div>
                    <a href="#" data-role="button" data-direction="reverse" data-theme="b" data-icon="arrow-r" data-iconpos="right" onclick="editGameFormSubmit();">Save Game Details</a>
                    <!-- <input type="submit" data-direction="reverse" data-icon="arrow-r" data-iconpos="right" value="Submit Settings" onsubmit="saveGameFormSubmit();" /> -->
                </form>
            </div>
        </div>
        
        
        <div data-role="page" id="page4">
            <div data-theme="a" data-role="header">
                <h3>
                    File Archives
                </h3>
                <a class="refreshButton" data-role="button" data-transition="fade" href="#page4" data-icon="refresh" data-iconpos="left" onclick="listDir(root);">
                    Refresh
                </a>
                <a data-role="button" data-transition="slidedown" href="#page1" data-icon="arrow-l" data-iconpos="left">
                    Back
                </a>
            </div>
            <div data-role="content">
                <div class="ui-grid-c" id="dirContent">
                    <div class="ui-block-a">
                        <div class="folder"><p>folder name</p></div>
                    </div>
                    <div class="ui-block-b">
                        <div class="folder"><p>folder name</p></div>
                    </div>
                    <div class="ui-block-c">
                        <div class="folder"><p>folder name</p></div>
                    </div>
                    <div class="ui-block-d">
                        <div class="folder"><p>folder name</p></div>
                    </div>
                    <!-- next row -->
                    <div class="ui-block-a">
                        <div class="file"><p>file name</p></div>
                    </div>
                    <div class="ui-block-b">
                        <div class="file"><p>file name</p></div>
                    </div>
                    <div class="ui-block-c">
                        <div class="file"><p>file name</p></div>
                    </div>
                    <div class="ui-block-d">
                        <div class="file"><p>file name</p></div>
                    </div>
                </div>
                <a id="menu" href="#menuOptions" data-rel="dialog">file details</a>
                <a id="get_file_details" href="#fileDetails" data-rel="dialog">file details</a>
            </div>                        
        </div>
        
        
        <div data-role="page" id="gamesArchive">
            <div data-theme="a" data-role="header">
                <h3>
                    Archives
                </h3>
                <a data-role="button" data-direction="reverse" href="#page1" data-icon="arrow-l" data-iconpos="left">
                    Back
                </a>
            </div>
            <div data-role="content">
                <ul id="archive-list" data-role="listview" data-filter="true" ><li>No Saved Games Available</ul>
            </div>                        
        </div>
        
        
        <div id="menuOptions" data-role="page">
            <div data-role="header">
                <h1>Select</h1>
            </div>
            <div data-role="content">
                <input type="button" id="openBtn" data-theme="e" value="Details" />
                <!-- <input type="button" id="copyBtn" value="Copy" />
                 <input type="button" id="moveBtn" value="Move" />
                 <input type="button" id="pasteBtn" value="Paste" disabled /> -->
                <input type="button" id="deleteBtn" value="Delete" />
            </div>
        </div>
        
        
        <div id="fileDetails" data-role="page">
            <div data-role="header">
                <h1>File</h1>
            </div>
            <div id="file_details" data-role="content"></div>
        </div>
        
        
        <div id="prefs" data-role="page">
            <div data-role="header">
                <h1>Preferences</h1>                
            </div>
            <div id="file_details" data-role="content">
            <p>Player name, default ruleset, dropbox integration, email address</p>
            </div>
        </div>
    </body>
</html>
